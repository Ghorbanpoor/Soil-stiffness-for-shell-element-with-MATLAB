clc
clear all
syms x y a b kx ky kz

aa=[1 x y x*y 0 0 0 0;
    0 0 0 0 1 x y x*y];

bb=[1 0 0 0 0 0 0 0;
    -1/a 0 0 0 1/a 0 0 0;
    -1/b 0 1/b 0 0 0 0 0;
    1/(a*b) 0 -1/(a*b) 0 -1/(a*b) 0 1/(a*b) 0;
    0 1 0 0 0 0 0 0;
    0 -1/a 0 0 0 1/a 0 0;
    0 -1/b 0 1/b 0 0 0 0;
    0 1/(a*b) 0 -1/(a*b) 0 -1/(a*b) 0 1/(a*b)];

cc=aa*bb;


dd=[0 0 -1 0 -x -2*y 0 -x^2 -2*x*y -3*y^2 -x^3 -3*x*y^2;
    0 1 0 2*x y 0 3*x^2 2*x*y y^2 0 3*x^2*y y^3;
    1 x y x^2 x*y y^2 x^3 x^2*y x*y^2 y^3 x^3*y x*y^3];

ee=[0 0 -1 0 0 0 0 0 0 0 0 0;
    0 1 0 0 0 0 0 0 0 0 0 0;
    1 0 0 0 0 0 0 0 0 0 0 0 ;
    0 0 -1 0 0 -2*b 0 0 0 -3*b^2 0 0;
    0 1 0 0 b 0 0 0 b^2 0 0 b^3; 
    1 0 b 0 0 b^2 0 0 0 b^3 0 0;
    0 0 -1 0 -a 0 0 -a^2 0 0 -a^3 0;
    0 1 0 2*a 0 0 3*a^2 0 0 0 0 0;
    1 a 0 a^2 0 0 a^2 0 0 0 0 0;
    0 0 -1 0 -a -2*b 0 -a^2 -2*a*b -3*b^2 -a^3 -3*a*b^2;
    0 1 0 2*a b 0 3*a^2 2*a*b b^2 0 3*a^2*b b^3;
    1 a b a^2 a*b b^2 a^3 a^2*b a*b^2 b^3 a^3*b a*b^3];

ff=dd*inv(ee);

nn=[(x*y)/(a*b) - y/b - x/a + 1 0 0 0 0 0  y/b - (x*y)/(a*b) 0 0 0 0 0 x/a - (x*y)/(a*b) 0 0 0 0 0 (x*y)/(a*b) 0 0 0 0 0;
    0 (x*y)/(a*b) - y/b - x/a + 1 0 0 0 0 0 y/b - (x*y)/(a*b) 0 0 0 0 0 x/a - (x*y)/(a*b) 0 0 0 0 0 (x*y)/(a*b) 0 0 0 0;
    0,0,(2*y^2)/b - y - y^3/b^2 + (x*y)/a - (2*x*y^2)/(a*b) + (x*y^3)/(a*b^2), (x^3*y)/(2*a*b - 3*a^2*b) - x^3/(2*a - 3*a^2) - ((3*a - 1)*x^2*y)/(2*a*b - 3*a^2*b) + ((3*a - 1)*x^2)/(2*a - 3*a^2) - (2*(a - 1)*x*y^3)/(b^2*(2*b - 3*a*b)) + (3*(a - 1)*x*y^2)/(b*(2*b - 3*a*b)) + ((2*a - 1)*x*y)/(2*b - 3*a*b) + x, (3*x^2)/(- 3*a^2 + 2*a) - (2*x^3)/(- 3*a^3 + 2*a^2) - (3*y^2)/b^2 + (2*y^3)/b^3 - (3*x^2*y)/(- 3*b*a^2 + 2*b*a) + (2*x^3*y)/(- 3*b*a^3 + 2*b*a^2) + (x*y)/(2*b - 3*a*b) - (3*x*y^2)/(b*(2*b - 3*a*b)) + (2*x*y^3)/(b^2*(2*b - 3*a*b)) + 1, 0,0,0,        y^2/b - y^3/b^2 - (x*y^2)/(a*b) + (x*y^3)/(a*b^2), (x*y)/b - (2*x^2*y)/(a*b) + (x^3*y)/(a^2*b), (3*y^2)/b^2 - (2*y^3)/b^3 - (3*x*y^2)/(a*b^2) - (3*x^2*y)/(a^2*b) + (2*x*y^3)/(a*b^3) + (2*x^3*y)/(a^3*b) + (x*y)/(a*b),0,0,0, - (x*y^3)/(a*b^2) + (2*x*y^2)/(a*b) - (x*y)/a,   (x^3*y)/(2*a*b - 3*a^2*b) - x^3/(2*a - 3*a^2) - (x^2*y)/(2*a*b - 3*a^2*b) + x^2/(2*a - 3*a^2) - (2*(a - 1)*x*y^3)/(b^2*(2*b - 3*a*b)) + (3*(a - 1)*x*y^2)/(b*(2*b - 3*a*b)) - ((a - 1)*x*y)/(2*b - 3*a*b), - (2*x^3*y)/(2*a^2*b - 3*a^3*b) + (2*x^3)/(2*a^2 - 3*a^3) + (3*x^2*y)/(2*a*b - 3*a^2*b) - (3*x^2)/(2*a - 3*a^2) - (2*x*y^3)/(b^2*(2*b - 3*a*b)) + (3*x*y^2)/(b*(2*b - 3*a*b)) - (x*y)/(2*b - 3*a*b),0,0,0, - (x*y^3)/(a*b^2) + (x*y^2)/(a*b),   (x^3*y)/(a^2*b) - (x^2*y)/(a*b), (3*x*y^2)/(a*b^2) + (3*x^2*y)/(a^2*b) - (2*x*y^3)/(a*b^3) - (2*x^3*y)/(a^3*b) - (x*y)/(a*b),0];

Ksx=eval(  int(int(kx *nn(1,:)'*nn(1,:),x,0,a),y,0,b) );
Ksy=eval(  int(int(ky *nn(2,:)'*nn(2,:),x,0,a),y,0,b) );
Ksz=simple(eval(  int(int(kz *nn(3,:)'*nn(3,:),x,0,a),y,0,b) ));
Ks=Ksx+Ksy+Ksz;
disp(Ks)
    
